"use strict";
(()=>{var g={INT:"integer",PERCENT:"percent"},k=class{constructor(t,s,e,o,a,r,h,c){this.xPos=t,this.yPos=s,this.width=e,this.height=o,this.name=a,this.displayString=a+": ",this.value=r,this.type=h,this.mouseOver=!1,this.promptModify=!1,this.active=!1,this.resetOnChange=c,Q.push(this),f.push(this),p.push(this),H.push(this)}draw(){i.strokeStyle=l.LGRAY,i.beginPath(),i.rect(this.xPos,this.yPos,this.width,this.height),i.stroke(),i.font=S,i.fillStyle=l.HEALTHY,i.fillText(this.displayString+this.value+(this.type===g.PERCENT?"%":""),this.xPos+this.width*.05,this.yPos+this.height*.8,this.width*.9),i.font=y}drawPromptBox(){i.beginPath(),i.rect(Y,M,L,_),i.fillStyle=l.BACKGROUND,i.fill(),i.beginPath(),i.rect(Y,M,L,_),i.strokeStyle=l.HEALTHY,i.stroke(),i.font=S,i.fillStyle=l.HEALTHY,i.fillText("Voer een nieuwe waarde in voor "+this.displayString,Y+10,M+15,L*.95),i.fillText("> "+b,Y+10,M+30,L*.95),i.font=y}modify(){this.active=!0,this.drawPromptBox()}clickHandler(){this.promptModify=!0,b=""}hoverHandler(){this.mouseOver=!0}mouseOutHandler(){this.mouseOver=!1}keyHandler(t){if(this.active)if(t>="0"&&t<="9"||t==".")b=b+t;else if(t=="Backspace")b=b.slice(0,b.length-1);else if(t=="Enter"){this.promptModify=!1,this.active=!1;let s;this.type==g.INT?s=parseInt(b):this.type==g.PERCENT&&(s=parseFloat(b)),this.value=s,this.resetOnChange==!0&&(C.value=B.RESTART)}else t=="Escape"&&(this.promptModify=!1,this.active=!1)}},Q=[],f=[],H=[],p=[],R=[],N=[],wt=new k(15,300,160,15,"Transmissiekans",10,g.PERCENT,!1),xt=new k(15,315,160,15,"Reiskans",5,g.PERCENT,!1),v=new k(15,330,160,15,"Begin infecties",3,g.INT,!1),kt=new k(15,345,160,15,"Herstelperiode",14,g.INT,!1),K=0,Y=150,M=75,L=300,_=45,tt,O,Et=5,Ht=5,T=new k(15,360,160,15,"Aantal huishoudens",20,g.INT,!0),u=[],Ct=0,et=100,st=100,it=50,ot=35,Rt=400,At=320,P=14,F=14,nt=0,Yt=0,Mt="myCanvas",w=document.getElementById(Mt),i=w.getContext("2d");i.imageSmoothingEnabled=!1;var at=w.offsetLeft,rt=w.offsetTop,Lt=n=>H.forEach(t=>t.keyHandler(n.key));w.addEventListener("click",Bt);w.addEventListener("mousemove",Nt);window.addEventListener("keydown",Lt);var Ot="14pt",lt='"Lucida Console", Monaco, monospace',y=Ot+" "+lt;i.font=y;var Ft="9pt",S=Ft+" "+lt,D=0,W=!1,X=30,Dt=Math.floor(1e3/X),zt=0,G=[v.value],U=[v.value],q=[v.value],b="",d=null,z,C,ht=!1,ut,l={BACKGROUND:"#000",HEALTHY:"#00FF00",SICK:"#FF0000",RECOVERED:"#FFFF00",LGRAY:"rgb(189, 255, 189)"},m={HEALTHY:"healthy",SICK:"sick",RECOVERED:"recovered"},A={SPEED1:60,SPEED2:30,SPEED3:15,SPEED4:8,SPEED5:2},$={RUN:"RUN",STOP:"STOP"},B={NORMAL:"NORMAL",RESTART:"RESTART"},ct=class{constructor(t,s,e,o){this.state=m.HEALTHY,this.xPos=t,this.yPos=s,this.community=e,this.position=o,this.daysSick=0,this.moving=!1,this.moveToX=0,this.moveToY=0,this.startX=0,this.startY=0,this.moveFrame=0,this.uniquePerson=zt++}draw(){switch(this.animate(),this.state){case m.HEALTHY:i.fillStyle=l.HEALTHY;break;case m.SICK:i.fillStyle=l.SICK;break;case m.RECOVERED:i.fillStyle=l.RECOVERED;break}i.fillText("Ï€",this.xPos,this.yPos,P-nt*2)}animate(){if(this.moving){let t=this.moveFrame/(d.value-1);this.xPos=this.startX*(1-t)+this.moveToX*t,this.yPos=this.startY*(1-t)+this.moveToY*t,this.moveFrame++}this.moveFrame>=d.value&&(this.moving=!1,this.moveFrame=0)}update(){this.state==m.SICK&&this.daysSick++,this.daysSick>kt.value&&(this.state=m.RECOVERED)}},mt=class{constructor(t,s,e){this.pickRandomPerson=()=>this.people[Math.floor(Math.random()*this.size)];this.countSick=()=>this.people.filter(t=>t.state==m.SICK).length;this.countSickToday=()=>this.people.filter(t=>t.state==m.SICK&&!t.daysSick).length;this.countTotalCases=()=>this.people.filter(t=>t.state!=m.HEALTHY).length;this.countMoving=()=>this.people.filter(t=>t.moving).length;this.update=()=>this.people.forEach(t=>t.update());let o=Math.ceil(Math.sqrt(t));this.uniqueCommunity=Ct++,this.height=o,this.width=o,this.xPos=s,this.yPos=e,this.size=t,this.people=new Array(t);for(let a=0;a<t;a++){let r=E(this,a);this.people[a]=new ct(r[0],r[1],this,a)}}draw(){for(let a=0;a<this.size;a++)this.people[a].draw();let t=this.xPos-P,s=this.xPos+(this.width+1)*P,e=this.yPos-2*P,o=this.yPos+this.height*P;i.beginPath(),i.moveTo(t,e),i.lineTo(s,e),i.lineTo(s,o),i.lineTo(t,o),i.lineTo(t,e),i.strokeStyle=l.LGRAY,i.stroke()}spread(){let t=[];for(let s=0;s<this.size;s++)this.people[s].state==m.SICK&&(this.spreadHelper(this.getNorth(s),t),this.spreadHelper(this.getSouth(s),t),this.spreadHelper(this.getEast(s),t),this.spreadHelper(this.getWest(s),t));for(let s=0,e=t.length;s<e;s++){let o=t[s];this.people[o].state=m.SICK}}getNorth(t){return t-this.width<0?null:t-this.width}getSouth(t){let s=t+this.width;return s>this.size-1?null:s}getEast(t){return t%this.width==this.width-1?null:t+1}getWest(t){return t%this.width==0?null:t-1}spreadHelper(t,s){if(t==null)return;let e=this.people[t].state;Math.random()<=wt.value/100&&e==m.HEALTHY&&s.push(t)}},I=class{constructor(t,s,e,o,a,r){this.data=t,this.xPos=s,this.yPos=e,this.yHeight=o,this.xWidth=a,this.name=r,this.defaultBarSize=5}drawAxes(){let t=this.yPos+this.yHeight;i.beginPath(),i.moveTo(this.xPos,this.yPos),i.lineTo(this.xPos,t),i.lineTo(this.xPos+this.xWidth,t),i.strokeStyle=l.LGRAY,i.stroke()}drawName(){i.font=S,i.fillStyle=l.HEALTHY,i.fillText(this.name,this.xPos,this.yPos-10,this.xWidth),i.font=y}drawYTicks(){let t=this.yPos+this.yHeight;i.fillStyle=l.SICK,i.font=S;let s=Math.max(...this.data);if(s<this.yHeight){let e=this.generateTickMarks(this.yHeight);for(let o=0,a=e.length;o<a;o++)i.fillText(`${e[o]}`,this.xPos-2*P,t-e[o]+F*.5),i.beginPath(),i.moveTo(this.xPos,t-e[o]),i.lineTo(this.xPos-5,t-e[o]),i.stroke()}else{let e=this.generateTickMarks(s);for(let o=0,a=e.length;o<a;o++){let r=e[e.length-1];i.fillText(`${e[o]}`,this.xPos-2*P,t-e[o]/r*this.yHeight+F*.5),i.beginPath(),i.moveTo(this.xPos,t-e[o]/r*this.yHeight),i.lineTo(this.xPos-5,t-e[o]/r*this.yHeight),i.stroke()}}i.font=y}drawXTicks(){let t=this.yPos+this.yHeight;i.fillStyle=l.SICK,i.font=S;let s=this.defaultBarSize;s*this.data.length>this.xWidth&&(s=this.xWidth/this.data.length);let o=this.xWidth/s,a=this.generateTickMarks(o),r;for(r=0;r<a.length;r++)i.fillText(`${a[r]}`,this.xPos+a[r]*s,t+F);i.font=y}generateTickMarks(t){let s,e,o=1;for(;s=10**o,e=Math.ceil(t/s),!(e>=4&&e<=9||(s=2*10**o,e=Math.ceil(t/s),e>=4&&e<=9)||(s=5*10**o,e=Math.ceil(t/s),e>=4&&e<=9));)o++;let a=[],r;for(r=0;r<=e;r++)a.push(r*s);return a}drawData(){let t,s=this.defaultBarSize,e=this.yPos+this.yHeight;s*this.data.length>this.xWidth&&(s=this.xWidth/this.data.length);let a=Math.max(...this.data);if(i.fillStyle=l.SICK,a<this.yHeight)for(t=0;t<this.data.length;t++){let r=e-this.data[t],h=this.xPos+t*s;i.beginPath(),i.rect(h,r,s,this.data[t]),i.fill()}else for(t=0;t<this.data.length;t++){let r=this.data[t]/a*this.yHeight,h=e-r,c=this.xPos+t*s;i.beginPath(),i.rect(c,h,s,r),i.fill()}}draw(){this.drawName(),this.drawAxes(),this.drawYTicks(),this.drawXTicks(),this.drawData()}},dt=class{constructor(t,s,e,o,a,r,h,c,x){this.xPos=t,this.yPos=s,this.width=e,this.height=o,this.label=a,this.value=r,this.cluster=h,this.active=!1,this.blink=x,this.blinkStep=0,f.push(this),c==!0&&(this.active=!0)}clickHandler(){this.cluster.update(this.value),this.active=!0,this.blinkStep=0}draw(){let t,s;this.blink?this.active==!0&&this.blinkStep%(X*2)<X?(t=l.BACKGROUND,s=l.HEALTHY):(t=l.HEALTHY,s=l.BACKGROUND):this.active==!0?(t=l.BACKGROUND,s=l.HEALTHY):(t=l.HEALTHY,s=l.BACKGROUND),i.beginPath(),i.rect(this.xPos,this.yPos,this.width,this.height),i.fillStyle=s,i.fill(),i.beginPath(),i.rect(this.xPos,this.yPos,this.width,this.height),i.strokeStyle=l.LGRAY,i.stroke(),i.font=S,i.fillStyle=t,i.fillText(this.label,this.xPos+5,this.yPos+12,this.width*.9),i.font=y,this.blinkStep=this.blinkStep+1}},V=class{constructor(t,s,e,o,a){this.update=t=>this.insideValue=t;this.xPos=t,this.yPos=s,this.width=e,this.height=o,this.label=a,this.buttons=[],N.push(this),this.insideValue=null,this.value=null}addButton(t,s,e,o,a,r,h,c){let x=new dt(t,s,e,o,a,r,this,h,c);return this.buttons.push(x),h==!0&&(this.value=r,this.insideValue=r),x}draw(){i.beginPath(),i.rect(this.xPos,this.yPos-this.height,this.width,this.height),i.strokeStyle=l.LGRAY,i.stroke(),i.font=S,i.fillStyle=l.HEALTHY,i.fillText(this.label,this.xPos+this.width*.05,this.yPos-this.height*.2,this.width*.9),i.font=y;let t;for(t=0;t<this.buttons.length;t++)this.buttons[t].draw()}commit(){this.value=this.insideValue;let t;for(t=0;t<this.buttons.length;t++)this.value==this.buttons[t].value?this.buttons[t].active=!0:this.buttons[t].active=!1}};function pt(){It(),Vt(),Kt(),ht==!1&&(ht=!0,ft())}function Wt(){R=[],K=0,u=[],D=0,W=!1,G=[v.value],U=[v.value],q=[v.value],b="",pt()}function ft(){C.value==B.RESTART&&(ut.clickHandler(0,0),Wt()),D%d.value==0&&Gt(),qt(),bt()==0&&(W=!0);let n;for(n=0;n<H.length;n++)if(H[n].promptModify==!0){H[n].modify(),j();return}if(D%d.value==0){let t;for(t=0;t<N.length;t++)N[t].commit();if(z.value==$.STOP){j();return}if(!W){for(t=0;t<u.length;t++)u[t].update(),u[t].spread();Xt(),Ut(),K++}}D++,j()}function j(){setTimeout(ft,Dt)}var $t=()=>R.forEach(n=>n.draw()),jt=()=>Q.forEach(n=>n.draw()),Zt=()=>N.forEach(n=>n.draw());function Xt(){G.push(bt()),U.push(Jt()),q.push(Qt())}function It(){let n=Math.ceil(Math.sqrt(T.value));O=n,tt=Math.ceil(T.value/n)}function Bt(n){let t=n.pageX-at,s=n.pageY-rt;for(let e=0,o=f.length;e<o;e++){let a=f[e].xPos,r=f[e].xPos+f[e].width,h=f[e].yPos,c=f[e].yPos+f[e].height;t>=a&&t<=r&&s>=h&&s<=c&&f[e].clickHandler()}}function Nt(n){let t=n.pageX-at,s=n.pageY-rt;for(let e=0,o=p.length;e<o;e++){let a=p[e].xPos,r=p[e].xPos+p[e].width,h=p[e].yPos,c=p[e].yPos+p[e].height;t>=a&&t<=r&&s>=h&&s<=c?p[e].hoverHandler():p[e].mouseOutHandler()}}var bt=()=>u.map(n=>n.countSick()).reduce((n,t)=>n+t),Jt=()=>u.map(n=>n.countSickToday()).reduce((n,t)=>n+t),Qt=()=>u.map(n=>n.countTotalCases()).reduce((n,t)=>n+t);function Gt(){for(let n=0,t=u.length;n<t;n++)for(let s=0,e=u[n].people.length;s<e;s++){let o=u[n].people[s],a=E(o.community,o.position);o.xPos=a[0],o.yPos=a[1]}}function E(n,t){let s=Math.floor(t/n.width),e=t%n.width,o=n.xPos+e*P+nt,a=n.yPos+s*F-Yt;return[o,a]}function Ut(){let t=_t()/2;for(let s=0;s<t;s++){let e=Z();e.moving=!0,e.moveFrame=0;let o=Z();for(;o.community==e.community;)o=Z();o.moving=!0,o.moveFrame=0;let a=E(e.community,e.position),r=E(o.community,o.position);e.startX=a[0],e.startY=a[1],o.startX=r[0],o.startY=r[1];let h=E(o.community,o.position),c=E(e.community,e.position);e.moveToX=h[0],e.moveToY=h[1],o.moveToX=c[0],o.moveToY=c[1];let x=e.community,yt=o.community,Pt=e.position,St=o.position;x.people[Pt]=o,yt.people[St]=e;let vt=e.community,Tt=e.position;e.community=o.community,e.position=o.position,o.community=vt,o.position=Tt}}var J,gt=()=>J=te().pickRandomPerson();function Z(){for(gt();J.moving;)gt();return J}function _t(){let n=ee(),t=0;for(let s=0;s<n;s++)Math.random()<=xt.value/100&&t++;return t%2&&t++,t}var ee=()=>u.map(n=>n.size).reduce((n,t)=>n+t),te=()=>u[Math.floor(Math.random()*T.value)];function se(){let n=2*ot+st*O,t=2*it+et*tt,s=Rt/n,e=At/t;return Math.min(s,e)}function qt(){ie(),i.fillStyle=l.HEALTHY,i.fillText(`${K}`,10,20),$t(),jt(),Zt();let n=se(),t=n,s=1/n;i.scale(t,t);for(let e=0;e<T.value;e++)u[e].draw();i.scale(s,s)}var ie=()=>i.clearRect(0,0,w.width,w.height);function Vt(){u=new Array(T.value);for(let n=0,t=T.value;n<t;n++){let s=Math.floor(n/O),e=n%O,o=ot+st*e,a=it+et*s;u[n]=new mt(Et*Ht,o,a)}R.push(new I(G,400,20,100,300,"Ziek vandaag")),R.push(new I(U,400,165,50,300,"Nieuwe zieken per dag")),R.push(new I(q,400,270,100,300,"Totaal aantal zieken")),d||(d=new V(200,315,100,15,"Snelheid:"),d.addButton(200,315,20,15,"1",A.SPEED1,!1,!1),d.addButton(220,315,20,15,"2",A.SPEED2,!1,!1),d.addButton(240,315,20,15,"3",A.SPEED3,!0,!1),d.addButton(260,315,20,15,"4",A.SPEED4,!1,!1),d.addButton(280,315,20,15,"5",A.SPEED5,!1,!1),z=new V(200,345,100,15,"Simulatie:"),z.addButton(200,345,50,15,"Start",$.RUN,!1,!0),z.addButton(250,345,50,15,"Stop",$.STOP,!0,!0),C=new V(200,390,100,15,"Simulatie Reset"),ut=C.addButton(-100,-100,1,1,"Normal",B.NORMAL,!0,!1),C.addButton(300,375,60,15,"Reset",B.RESTART,!1,!1))}function Kt(){let n=0;for(;n<v.value;){let t=Math.floor(Math.random()*T.value),s=u[t],e=s.size,o=Math.floor(Math.random()*e);s.people[o].state==m.HEALTHY&&(n++,s.people[o].state=m.SICK)}}pt();})();
