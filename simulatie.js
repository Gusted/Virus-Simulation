"use strict";
(()=>{var v={INT:"integer",PERCENT:"percent"},k=class{constructor(t,s,e,o,a,l,h,u){this.xPos=t,this.yPos=s,this.width=e,this.height=o,this.name=a,this.displayString=a+": ",this.value=l,this.type=h,this.mouseOver=!1,this.promptModify=!1,this.active=!1,this.resetOnChange=u,ot.push(this),p.push(this),g.push(this),R.push(this)}draw(){i.strokeStyle=r.LGRAY,i.beginPath(),i.rect(this.xPos,this.yPos,this.width,this.height),i.stroke(),i.font=S,i.fillStyle=r.HEALTHY,i.fillText(this.displayString+this.value+(this.type===v.PERCENT?"%":""),this.xPos+this.width*.05,this.yPos+this.height*.8,this.width*.9),i.font=d}drawPromptBox(){i.beginPath(),i.rect(N,O,D,nt),i.fillStyle=r.BACKGROUND,i.fill(),i.beginPath(),i.rect(N,O,D,nt),i.strokeStyle=r.HEALTHY,i.stroke(),i.font=S,i.fillStyle=r.HEALTHY,i.fillText("Voer een nieuwe waarde in voor "+this.displayString,N+10,O+15,D*.95),i.fillText("> "+b,N+10,O+30,D*.95),i.font=d}modify(){this.active=!0,this.drawPromptBox()}clickHandler(){this.promptModify=!0,b=""}hoverHandler(){this.mouseOver=!0}mouseOutHandler(){this.mouseOver=!1}keyHandler(t){if(this.active)if(t>="0"&&t<="9"||t==".")b=b+t;else if(t=="Backspace")b=b.slice(0,b.length-1);else if(t=="Enter"){this.promptModify=!1,this.active=!1;let s;this.type==v.INT?s=parseInt(b):this.type==v.PERCENT&&(s=parseFloat(b)),this.value=s,this.resetOnChange==!0&&(M.value=I.RESTART)}else t=="Escape"&&(this.promptModify=!1,this.active=!1)}},ot=[],p=[],R=[],g=[],X=[],F=[],Ht=new k(15,300,160,15,"Transmissiekans",10,v.PERCENT,!1),Rt=new k(15,315,160,15,"Reiskans",5,v.PERCENT,!1),T=new k(15,330,160,15,"Begin infecties",3,v.INT,!1),Mt=new k(15,345,160,15,"Herstelperiode",14,v.INT,!1),U=0,N=150,O=75,D=300,nt=45,at,z,At=5,Yt=5,x=new k(15,360,160,15,"Aantal huishoudens",20,v.INT,!0),c=[],Lt=0,lt=100,rt=100,ht=50,ct=35,Bt=400,Nt=320,y=14,P=14,Ot=0,Dt=0,E=document.getElementById("myCanvas"),i=E.getContext("2d",{alpha:!1});i.imageSmoothingEnabled=!1;var ut=E.offsetLeft,mt=E.offsetTop,It=n=>R.forEach(t=>t.keyHandler(n.key));E.addEventListener("click",Ft);E.addEventListener("mousemove",zt);window.addEventListener("keydown",It);var Vt="14pt",dt='"Lucida Console", Monaco, monospace',d=Vt+" "+dt;i.font=d;var Kt="9pt",S=Kt+" "+dt,V=0,q=!1,$=30,Wt=Math.floor(1e3/$),Gt=0,j=[T.value],Z=[T.value],J=[T.value],b="",f=null,K,M,ft=!1,pt,r={BACKGROUND:"#000",HEALTHY:"#00FF00",SICK:"#FF0000",RECOVERED:"#FFFF00",LGRAY:"rgb(189, 255, 189)"},m={HEALTHY:"healthy",SICK:"sick",RECOVERED:"recovered"},A={SPEED1:60,SPEED2:30,SPEED3:15,SPEED4:8,SPEED5:2},Q={RUN:"RUN",STOP:"STOP"},I={NORMAL:"NORMAL",RESTART:"RESTART"},gt=class{constructor(t,s,e,o){this.state=m.HEALTHY,this.xPos=t,this.yPos=s,this.community=e,this.position=o,this.daysSick=0,this.moving=!1,this.moveToX=0,this.moveToY=0,this.startX=0,this.startY=0,this.moveFrame=0,this.uniquePerson=Gt++}draw(){switch(this.animate(),this.state){case m.HEALTHY:i.drawImage(w,this.xPos,this.yPos-P,y,14);break;case m.SICK:i.drawImage(_,this.xPos,this.yPos-P,y,14);break;case m.RECOVERED:i.drawImage(tt,this.xPos,this.yPos-P,y,14);break}}animate(){if(this.moving){let t=this.moveFrame/(f.value-1);this.xPos=this.startX*(1-t)+this.moveToX*t,this.yPos=this.startY*(1-t)+this.moveToY*t,this.moveFrame++}this.moveFrame>=f.value&&(this.moving=!1,this.moveFrame=0)}update(){this.state==m.SICK&&this.daysSick++,this.daysSick>Mt.value&&(this.state=m.RECOVERED)}},bt=class{constructor(t,s,e){this.pickRandomPerson=()=>this.people[Math.floor(Math.random()*this.size)];this.countSick=()=>this.people.filter(t=>t.state==m.SICK).length;this.countSickToday=()=>this.people.filter(t=>t.state==m.SICK&&!t.daysSick).length;this.countTotalCases=()=>this.people.filter(t=>t.state!=m.HEALTHY).length;this.countMoving=()=>this.people.filter(t=>t.moving).length;this.update=()=>this.people.forEach(t=>t.update());let o=Math.ceil(Math.sqrt(t));this.uniqueCommunity=Lt++,this.height=o,this.width=o,this.xPos=s,this.yPos=e,this.size=t,this.people=Array.from({length:t});for(let a=0;a<t;a++){let l=H(this,a);this.people[a]=new gt(l[0],l[1],this,a)}}draw(){for(let a=0;a<this.size;a++)this.people[a].draw();let t=this.xPos-y,s=this.xPos+(this.width+1)*y,e=this.yPos-2*y,o=this.yPos+this.height*y;i.beginPath(),i.moveTo(t,e),i.lineTo(s,e),i.lineTo(s,o),i.lineTo(t,o),i.lineTo(t,e),i.strokeStyle=r.LGRAY,i.stroke()}spread(){let t=[];for(let s=0;s<this.size;s++)this.people[s].state==m.SICK&&(this.spreadHelper(this.getNorth(s),t),this.spreadHelper(this.getSouth(s),t),this.spreadHelper(this.getEast(s),t),this.spreadHelper(this.getWest(s),t));for(let s=0,e=t.length;s<e;s++){let o=t[s];this.people[o].state=m.SICK}}getNorth(t){return t-this.width<0?null:t-this.width}getSouth(t){let s=t+this.width;return s>this.size-1?null:s}getEast(t){return t%this.width==this.width-1?null:t+1}getWest(t){return t%this.width==0?null:t-1}spreadHelper(t,s){if(t==null)return;let e=this.people[t].state;Math.random()<=Ht.value/100&&e==m.HEALTHY&&s.push(t)}},W=class{constructor(t,s,e,o,a,l){this.data=t,this.xPos=s,this.yPos=e,this.yHeight=o,this.xWidth=a,this.name=l,this.defaultBarSize=5}drawAxes(){let t=this.yPos+this.yHeight;i.beginPath(),i.moveTo(this.xPos,this.yPos),i.lineTo(this.xPos,t),i.lineTo(this.xPos+this.xWidth,t),i.strokeStyle=r.LGRAY,i.stroke()}drawName(){i.font=S,i.fillStyle=r.HEALTHY,i.fillText(this.name,this.xPos,this.yPos-10,this.xWidth),i.font=d}drawYTicks(){let t=this.yPos+this.yHeight;i.fillStyle=r.SICK,i.font=S;let s=Math.max(...this.data);if(s<this.yHeight){let e=this.generateTickMarks(this.yHeight);for(let o=0,a=e.length;o<a;o++)i.fillText(`${e[o]}`,this.xPos-2*y,t-e[o]+P*.5),i.beginPath(),i.moveTo(this.xPos,t-e[o]),i.lineTo(this.xPos-5,t-e[o]),i.stroke()}else{let e=this.generateTickMarks(s);for(let o=0,a=e.length;o<a;o++){let l=e[e.length-1];i.fillText(`${e[o]}`,this.xPos-2*y,t-e[o]/l*this.yHeight+P*.5),i.beginPath(),i.moveTo(this.xPos,t-e[o]/l*this.yHeight),i.lineTo(this.xPos-5,t-e[o]/l*this.yHeight),i.stroke()}}i.font=d}drawXTicks(){let t=this.yPos+this.yHeight;i.fillStyle=r.SICK,i.font=S;let s=this.defaultBarSize;s*this.data.length>this.xWidth&&(s=this.xWidth/this.data.length);let o=this.xWidth/s,a=this.generateTickMarks(o),l;for(l=0;l<a.length;l++)i.fillText(`${a[l]}`,this.xPos+a[l]*s,t+P);i.font=d}generateTickMarks(t){let s,e,o=1;for(;s=10**o,e=Math.ceil(t/s),!(e>=4&&e<=9||(s=2*10**o,e=Math.ceil(t/s),e>=4&&e<=9)||(s=5*10**o,e=Math.ceil(t/s),e>=4&&e<=9));)o++;let a=[],l;for(l=0;l<=e;l++)a.push(l*s);return a}drawData(){let t,s=this.defaultBarSize,e=this.yPos+this.yHeight;s*this.data.length>this.xWidth&&(s=this.xWidth/this.data.length);let a=Math.max(...this.data);if(i.fillStyle=r.SICK,a<this.yHeight)for(t=0;t<this.data.length;t++){let l=e-this.data[t],h=this.xPos+t*s;i.beginPath(),i.rect(h,l,s,this.data[t]),i.fill()}else for(t=0;t<this.data.length;t++){let l=this.data[t]/a*this.yHeight,h=e-l,u=this.xPos+t*s;i.beginPath(),i.rect(u,h,s,l),i.fill()}}draw(){this.drawName(),this.drawAxes(),this.drawYTicks(),this.drawXTicks(),this.drawData()}},yt=class{constructor(t,s,e,o,a,l,h,u,C){this.xPos=t,this.yPos=s,this.width=e,this.height=o,this.label=a,this.value=l,this.cluster=h,this.active=!1,this.blink=C,this.blinkStep=0,p.push(this),u==!0&&(this.active=!0)}clickHandler(){this.cluster.update(this.value),this.active=!0,this.blinkStep=0}draw(){let t,s;this.blink?this.active==!0&&this.blinkStep%($*2)<$?(t=r.BACKGROUND,s=r.HEALTHY):(t=r.HEALTHY,s=r.BACKGROUND):this.active==!0?(t=r.BACKGROUND,s=r.HEALTHY):(t=r.HEALTHY,s=r.BACKGROUND),i.beginPath(),i.rect(this.xPos,this.yPos,this.width,this.height),i.fillStyle=s,i.fill(),i.beginPath(),i.rect(this.xPos,this.yPos,this.width,this.height),i.strokeStyle=r.LGRAY,i.stroke(),i.font=S,i.fillStyle=t,i.fillText(this.label,this.xPos+5,this.yPos+12,this.width*.9),i.font=d,this.blinkStep=this.blinkStep+1}},G=class{constructor(t,s,e,o,a){this.update=t=>this.insideValue=t;this.xPos=t,this.yPos=s,this.width=e,this.height=o,this.label=a,this.buttons=[],F.push(this),this.insideValue=null,this.value=null}addButton(t,s,e,o,a,l,h,u){let C=new yt(t,s,e,o,a,l,this,h,u);return this.buttons.push(C),h==!0&&(this.value=l,this.insideValue=l),C}draw(){i.beginPath(),i.rect(this.xPos,this.yPos-this.height,this.width,this.height),i.strokeStyle=r.LGRAY,i.stroke(),i.font=S,i.fillStyle=r.HEALTHY,i.fillText(this.label,this.xPos+this.width*.05,this.yPos-this.height*.2,this.width*.9),i.font=d;let t;for(t=0;t<this.buttons.length;t++)this.buttons[t].draw()}commit(){this.value=this.insideValue;let t;for(t=0;t<this.buttons.length;t++)this.value==this.buttons[t].value?this.buttons[t].active=!0:this.buttons[t].active=!1}},w,Y,_,L,tt,B;function Xt(){w=document.createElement("canvas"),Y=w.getContext("2d"),w.width=14,w.height=14,_=w.cloneNode(),L=_.getContext("2d"),tt=w.cloneNode(),B=tt.getContext("2d"),Y.imageSmoothingEnabled=!1,Y.font=d,Y.fillStyle=r.HEALTHY,Y.fillText("π",0,P),L.imageSmoothingEnabled=!1,L.font=d,L.fillStyle=r.SICK,L.fillText("π",0,P),B.imageSmoothingEnabled=!1,B.font=d,B.fillStyle=r.RECOVERED,B.fillText("π",0,P)}function vt(){Xt(),Ut(),qt(),$t(),ft==!1&&(ft=!0,Pt())}function jt(){X=[],U=0,c=[],V=0,q=!1,j=[T.value],Z=[T.value],J=[T.value],b="",vt()}function Pt(){M.value==I.RESTART&&(pt.clickHandler(),jt()),V%f.value==0&&Jt(),_t(),St()==0&&(q=!0);let n;for(n=0;n<R.length;n++)if(R[n].promptModify==!0){R[n].modify(),et();return}if(V%f.value==0){let t;for(t=0;t<F.length;t++)F[t].commit();if(K.value==Q.STOP){et();return}if(!q){for(t=0;t<c.length;t++)c[t].update(),c[t].spread();Zt(),Qt(),U++}}V++,et()}function et(){setTimeout(Pt,Wt)}var te=()=>X.forEach(n=>n.draw()),ee=()=>ot.forEach(n=>n.draw()),se=()=>F.forEach(n=>n.draw());function Zt(){j.push(St()),Z.push(ie()),J.push(oe())}function Ut(){let n=Math.ceil(Math.sqrt(x.value));z=n,at=Math.ceil(x.value/n)}function Ft(n){let t=n.pageX-ut,s=n.pageY-mt;for(let e=0,o=p.length;e<o;e++){let a=p[e].xPos,l=p[e].xPos+p[e].width,h=p[e].yPos,u=p[e].yPos+p[e].height;t>=a&&t<=l&&s>=h&&s<=u&&p[e].clickHandler()}}function zt(n){let t=n.pageX-ut,s=n.pageY-mt;for(let e=0,o=g.length;e<o;e++){let a=g[e].xPos,l=g[e].xPos+g[e].width,h=g[e].yPos,u=g[e].yPos+g[e].height;t>=a&&t<=l&&s>=h&&s<=u?g[e].hoverHandler():g[e].mouseOutHandler()}}var St=()=>c.map(n=>n.countSick()).reduce((n,t)=>n+t),ie=()=>c.map(n=>n.countSickToday()).reduce((n,t)=>n+t),oe=()=>c.map(n=>n.countTotalCases()).reduce((n,t)=>n+t);function Jt(){for(let n=0,t=c.length;n<t;n++)for(let s=0,e=c[n].people.length;s<e;s++){let o=c[n].people[s],a=H(o.community,o.position);o.xPos=a[0],o.yPos=a[1]}}function H(n,t){let s=Math.floor(t/n.width),e=t%n.width,o=n.xPos+e*y+Ot,a=n.yPos+s*P-Dt;return[o,a]}function Qt(){let t=ne()/2;for(let s=0;s<t;s++){let e=st();e.moving=!0,e.moveFrame=0;let o=st();for(;o.community==e.community;)o=st();o.moving=!0,o.moveFrame=0;let a=H(e.community,e.position),l=H(o.community,o.position);e.startX=a[0],e.startY=a[1],o.startX=l[0],o.startY=l[1];let h=H(o.community,o.position),u=H(e.community,e.position);e.moveToX=h[0],e.moveToY=h[1],o.moveToX=u[0],o.moveToY=u[1];let C=e.community,xt=o.community,Et=e.position,wt=o.position;C.people[Et]=o,xt.people[wt]=e;let Ct=e.community,kt=e.position;e.community=o.community,e.position=o.position,o.community=Ct,o.position=kt}}var it,Tt=()=>it=ae().pickRandomPerson();function st(){for(Tt();it.moving;)Tt();return it}function ne(){let n=le(),t=0;for(let s=0;s<n;s++)Math.random()<=Rt.value/100&&t++;return t%2&&t++,t}var le=()=>c.map(n=>n.size).reduce((n,t)=>n+t),ae=()=>c[Math.floor(Math.random()*x.value)];function re(){let n=2*ct+rt*z,t=2*ht+lt*at,s=Bt/n,e=Nt/t;return Math.min(s,e)}function _t(){he(),i.fillStyle=r.HEALTHY,i.fillText(`${U}`,10,20),te(),ee(),se();let n=re(),t=n,s=1/n;i.scale(t,t);for(let e=0;e<x.value;e++)c[e].draw();i.scale(s,s)}var he=()=>i.clearRect(0,0,E.width,E.height);function qt(){c=Array.from({length:x.value});for(let n=0,t=x.value;n<t;n++){let s=Math.floor(n/z),e=n%z,o=ct+rt*e,a=ht+lt*s;c[n]=new bt(At*Yt,o,a)}X.push(new W(j,400,20,100,300,"Ziek vandaag"),new W(Z,400,165,50,300,"Nieuwe zieken per dag"),new W(J,400,270,100,300,"Totaal aantal zieken")),f||(f=new G(200,315,100,15,"Snelheid:"),f.addButton(200,315,20,15,"1",A.SPEED1,!1,!1),f.addButton(220,315,20,15,"2",A.SPEED2,!1,!1),f.addButton(240,315,20,15,"3",A.SPEED3,!0,!1),f.addButton(260,315,20,15,"4",A.SPEED4,!1,!1),f.addButton(280,315,20,15,"5",A.SPEED5,!1,!1),K=new G(200,345,100,15,"Simulatie:"),K.addButton(200,345,50,15,"Start",Q.RUN,!1,!0),K.addButton(250,345,50,15,"Stop",Q.STOP,!0,!0),M=new G(200,390,100,15,"Simulatie Reset"),pt=M.addButton(-100,-100,1,1,"Normal",I.NORMAL,!0,!1),M.addButton(300,375,60,15,"Reset",I.RESTART,!1,!1))}function $t(){let n=0;for(;n<T.value;){let t=Math.floor(Math.random()*x.value),s=c[t],e=s.size,o=Math.floor(Math.random()*e);s.people[o].state==m.HEALTHY&&(n++,s.people[o].state=m.SICK)}}vt();})();
